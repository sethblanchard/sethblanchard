<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
		<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Pythagreaon Pennants</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<!--//@import url(); // Font from Google... -->
		<link href='http://fonts.googleapis.com/css?family=Arvo:400,700' rel='stylesheet' type='text/css'>
  		<link rel="stylesheet" href="css/sethblanchard.css" />
  		<script src="js/vendor/custom.modernizr.js"></script>
</head>
<body>
	<nav id="Menu" class="Nav active">
			<!--TODO: Try as a tree map?? -->
			<ul class="Nav--List">
				<li class="Nav--List--Item">
					<a href="index.html"  class="Nav--List--Item--Link">
						Home
					</a>
				</li>
				<li class="Nav--List--Item">
					<a href="about.html"  class="Nav--List--Item--Link">
						About
					</a>
				</li>
			</ul>
			<ul class="Nav--Article--List">
				<li class="Nav--Article--List--Item Nav--Article--List--Title">
					Articles
				</li>
				<li class="Nav--Article--List--Item">
					<a href="PythagoreanPennants.html"  class="Nav--Article--List--Item--Link">
						Pythagorean Pennants
					</a>
				</li>
				<li class="Nav--Article--List--Item">
					<a href="PythagoreanPennants.html"  class="Nav--Article--List--Item--Link">
						20 or More
					</a>
				</li>
				<li class="Nav--Article--List--Item">
					<a href="PythagoreanPennants.html"  class="Nav--Article--List--Item--Link">
						Transforming Tufte pt.1
					</a>
				</li>
				<li class="Nav--Article--List--Item">
					<a href="PythagoreanPennants.html"  class="Nav--Article--List--Item--Link">
						Transforming Tufte pt.2
					</a>
				</li>
				<li class="Nav--Article--List--Item">
					<a href="PythagoreanPennants.html"  class="Nav--Article--List--Item--Link">
						Transforming Tufte pt.3
					</a>
				</li>
				<li class="Nav--Article--List--Item">
					<a href="PythagoreanPennants.html"  class="Nav--Article--List--Item--Link">
						Transforming Tufte pt.4
					</a>
				</li>
			</ul>
		</nav>
		<section id="Main" class="grid main active">
			<header class="Title--Bar">
				<h1 class="Title--Bar--Logo Logo"><a href="index.html">SB</a></h1>
				<a class="Title--Bar--Button" href="#Footer-Menu">
					<img class="Title--Bar--Button--Icon" src="Content/menu_icon.png" />
					Menu
				</a>
			</header>
			<h1 class="masthead">Pythagorean Pennants</h1>
			<h2 class="byline">Repurposing the pennant on your wall to tell your favorite team's future</h2>
			<div id="Chart" class="row">
			</div>
			<div class="row">
				<article class="col-5">
					<p>
						The Pythagorean Expectation or Projection is way of measuring your team's actual performance. It essentially says that a team's point differential is a better predictor of future performance than their actual record. It was developed by the great Bill James<sup><a id="footnoteLink_1" href="#footnote_1">[1]</a></sup> and adapted for basketball by Daryl Morely<sup><a href="#footnote_2">[2]</a></sup> and shown for football on the FootballOutsiders<sup><a href="#footnote_3">[3]</a></sup> website.
					</p>
					<p>
						I took the numbers and put a visual twist on them, see your favorite team colors - like on your wall as a kid - and quickly see which way your team could be headed in the upcoming season. 
					</p>
					<p>
					More text that you will write here something, something something
					</p>
					<div id="parallelCoordinates">
					</div>
					<footer>
						<ol>
							<li id="footnote_1">
								Bill James - inventor of Sabermatrics... <a href="#footnoteLink_1">^</a>
							</li>
							<li id="footnote_1">
								Daryl Morely - houston rockets GM and ... <a href="#footnoteLink_1">^</a>
							</li>
							<li id="footnote_3">
								Football Outsidres - inventor of Sabermatrics... <a href="#footnoteLink_3">^</a>
							</li>
						</ol>
					</footer>
				</article>
			</div>
			<div class="row">
				<section class="col-3 ">
					<h4>About this Graphic</h4>
					<p>
						After learning about the pythagorean expectation as well as some other stats (upcoming graphics), mostly by reading @BillBarnwell I wasnted to see what the pythagorean would literally look like. 
					</p>
					<p>
						I was unsure if the triangles would communicate how I think about the expecation, but after switching from a scatter plot to a series of small multiples I was pleasantly surprised with the result. 
					</p>
					<p >
						As with most things this graphic is really a remix. And in that same spirit, grab the data and grab the code and make something different from it.
						<a href="#">Data</a>
						<a href="#">Fork on Github</a>
					</p>
				</section>
				<section class="col-2">
					<h4>References</h4>
					<ul>
						<li>Profootball-reference</li>
						<li>Barnwell Regression</li>
						<li>Data Sets - url</li>
					</ul>
				</section>
			</div>
		</section>
<footer class="site-footer">
			<h1 class="Logo footer--Logo">SB</h1>
			<nav id="Footer-Menu" class="footer--Menu small-col-4">
				<!--TODO: Try as a tree map?? -->
				<ul class="footer--Nav">
					<li class="footer--Nav--Item">
						<a class="footer--Nav--Item--Link" href="index.html">
							Home
						</a>
					</li>
					<li class="footer--Nav--Item">
						<a class="footer--Nav--Item--Link" href="about.html">
							About
						</a>
					</li>
				</ul>
			</nav>
			<div class="col-1 small-col-4">
				<h4>Highlighted Articles</h4>
				<ul class="footer--FeaturedArticles">
					<li class="footer--FeaturedArticles--Item">
						<a href="PythagoreanPennants.html"  class="footer--FeaturedArticles--Item--Link">
							Pythagorean Pennants
						</a>
					</li>
				</ul>
			</div>
			<div class="footer-Elsewhere col-1 small-col-4">
				<h4 class="">Elsewhere</h4>
				<ul class="footer--Nav">
					<li class="footer--Nav--Item">
						<a class="footer--Nav--Item--Link"  href="twitter">
							Twitter
						</a>
					</li>
					<li class="footer--Nav--Item">
						<a class="footer--Nav--Item--Link"  href="soundcloud">
							Soundcloud
						</a>
					</li>
					<li class="footer--Nav--Item">
						<a class="footer--Nav--Item--Link"  href="linkedin">
							LinkedIn
						</a>
					</li>
					<li class="footer--Nav--Item">
						<a class="footer--Nav--Item--Link"  href="github">
							Github
						</a>
					</li>
				</ul>
			</div>
			<blockquote class="footer--Quote col-1 hide-small">
				Torres Del Paine is my spirit animal.
			</blockquote>
			<span class="copyright">&#169; 2013 - 2014 Seth Blanchard</span>
		</footer>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
        <script src="js/vendor/jquery.jpanelmenu.min.js"></script>
  		<script src="js/vendor/d3.v3.js"></script>
        <script src="js/main.js"></script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X');ga('send','pageview');
        </script>

        <script>

			var jPM = $.jPanelMenu({
			    menu: '#Menu',
			    trigger: '.Title--Bar--Button'
			});
			jPM.on();


			/*
			TODO: 
				1. Clean up when you are done.
			*/


		var teamInfo = {
				"DEN": { "PrimaryColor":	"#FB4F14", "SecondaryColor":	"#002244"},
				"ATL": { "PrimaryColor":	"#BD0D18", "SecondaryColor":	"#000000"},
				"NE": { "PrimaryColor":	"#0D254C", "SecondaryColor":	"#C80815"},
				"SF": { "PrimaryColor":	"#AF1E2C", "SecondaryColor":	"#E6BE8A"},
				"HOU": { "PrimaryColor":	"#02253A", "SecondaryColor":	"#B31B34"},
				"GB": { "PrimaryColor":	"#213D30", "SecondaryColor":	"#FFCC00"},
				"BAL": { "PrimaryColor":	"#280353", "SecondaryColor":	"#000000"},
				"WAS": { "PrimaryColor":	"#773141", "SecondaryColor":	"#FFB612"},
				"IND": { "PrimaryColor":	"#003B7B", "SecondaryColor":	"#FFFFFF"},
				"SEA": { "PrimaryColor":	"#06192E", "SecondaryColor":	"#4EAE47"},
				"CIN": { "PrimaryColor":	"#FB4F14", "SecondaryColor":	"#000000"},
				"MIN": { "PrimaryColor":	"#3B0160", "SecondaryColor":	"#F0BF00"},
				"CHI": { "PrimaryColor":	"#03202F", "SecondaryColor":	"#DD4814"},
				"NYG": { "PrimaryColor":	"#192F6B", "SecondaryColor":	"#CA001A"},
				"PIT": { "PrimaryColor":	"#000000", "SecondaryColor":	"#F2C800"},
				"DAL": { "PrimaryColor":	"#002244", "SecondaryColor":	"#8C8B8A"},
				"MIA": { "PrimaryColor":	"#006666", "SecondaryColor":	"#DF6108"},
				"SD": { "PrimaryColor":	"#5B92E5", "SecondaryColor":	"#EEC607"},
				"NO": { "PrimaryColor":	"#D2B887", "SecondaryColor":	"#000000"},
				"STL": { "PrimaryColor":	"#13264B", "SecondaryColor":	"#C9AF74"},
				"TB": { "PrimaryColor":	"#B20032", "SecondaryColor":	"#89765F"},
				"CAR": { "PrimaryColor":	"#000000", "SecondaryColor":	"#0088CE"},
				"NYJ": { "PrimaryColor":	"#0C371D", "SecondaryColor":	"#FFFFFF"},
				"TEN": { "PrimaryColor":	"#648FCC", "SecondaryColor":	"#000080"},
				"BUF": { "PrimaryColor":	"#00338D", "SecondaryColor":	"#C60C30"},
				"CLE": { "PrimaryColor":	"#E34912", "SecondaryColor":	"#26201E"},
				"ARI": { "PrimaryColor":	"#870619", "SecondaryColor":	"#000000"},
				"OAK": { "PrimaryColor":	"#C4C8CB", "SecondaryColor":	"#000000"},
				"PHI": { "PrimaryColor":	"#003B48", "SecondaryColor":	"#C0C0C0"},
				"DET": { "PrimaryColor":	"#006DB0", "SecondaryColor":	"#C5C7CF"},
				"JAC": { "PrimaryColor":	"#007198", "SecondaryColor":	"#D0B239"},
				"KC": { "PrimaryColor":	"#B20032", "SecondaryColor":	"#F2C800"}
			};


			var xdiffs = [],
				ydiffs =[];

			var allTheDatas;
			

			//Sort by Wins and then point differential descending
			var sortTeams = function(a,b){
				return (parseFloat(b.W) == parseFloat(a.W)) ? 
					 	parseFloat(b.PtDif) - parseFloat(a.PtDif) :
					 	parseFloat(b.W) - parseFloat(a.W);
			}

			var plotRegression = function(seasonData){
			
				//Tm,shortname,Year,W,L,T,WLPct,Pts,PtsO,PtDif,PW,PWDiff
				allTheDatas = seasonData; // just for debugging
				console.log(seasonData);

				//Generate a hash of arrays for each year
				var yearData = d3.nest().key(function(d){ return +d.Year; }).sortValues(sortTeams).map(allTheDatas, d3.map);

				var width = 155, //should be based on the width of the row (we even overwrite it in the CSS) also do something here for media queries... 
			    	height = 130, //I'm cool with set height
			    	domainWidth = 500, //should be dynamic with sliders - set size of pennats (up and down etc)
			    	domainHieght = 500, //should be dynamic with sliders
			    	margin = 50;

				var x= d3.scale.linear().domain([0,600]).range([margin,domainWidth-margin]); //points scored -- diff
				var y= d3.scale.linear().domain([0,16]).range([height-domainHieght,margin]); //pythagreon diff
				

				//Funciton Calculates the offsets from center to plot the pennenats
				//and values used to locate the hover labels
				//The only thing that changes is the order you pass in the values
				//and the scale function you use
				//This funciton is way less readable at first... maybe not worth the refactor
				//x used to be
				//	var x1 = x(d.ptso),
				// 		x2 = x(d.pts),
				// 		xDiff = x2 - x1,
				// 		xA = xCenter - xDiff/2,
				//		xB = xCenter + xDiff/2;
				var locationPoints = function(scale, center, value1, value2){

					var pos1 = scale(value1),
						pos2 = scale(value2),
						posDiff = pos2 - pos1,
						posA = center - posDiff/2,
						posB = center + posDiff/2;

					return([posA, posB]);
				};

				//convenience functions to encode the change in order of values
				var xPoints = function(d){
					return locationPoints(x, width/2, d.PtsO, d.Pts);
				};
				

				var yPoints = function(d){

					return locationPoints(y, height/2, d.PW, d.W)
					/*
					// var y1 = y(d.w),
					// 	//y2 = y(d.w + mapWinDifference(d.wdiff)); //Show likley regression for next year
					// 	y2 = y(d.pw), //or how many games the team should have one this year.. 
					// 	yDiff = y1 - y2,
					// 	yA = yCenter - yDiff/2,
					// 	yB = yCenter + yDiff/2  
					// 	return [yA,yB];
					*/
				};


				var triangle = function(d){

					var xPts = xPoints(d),
						yPts = yPoints(d);


					var path = "M " + xPts[0] + " " + yPts[0] + " L " + xPts[1] + " " + yPts[0] + " L " + xPts[1] + " " + yPts[1] + " z";

						return path;
				};

				//mapping from the table from Barnwell's article
				var mapWinDifference = function(winDelta){

						if(winDelta < -2){
								return 2.6;
						}else if(winDelta < -1.5){
								return 2.5;

						}else if(winDelta < -1){
								return 2.0;

						}else if(winDelta < -0.5){
								return 0.6;

						}else if(winDelta < 0.5){
								return 0;

						}else if(winDelta < 1){
								return -0.9;

						}else if(winDelta < 1.5){
								return -1.5;

						}else if(winDelta < 2){
								return -1.8;

						}else{
								return -2.5;
						}
				};


		  	 	var svg = d3.select("#Chart").selectAll(".team")
				      .data(yearData.get(2013)) //this could be updated to take let you pick the year
					    .enter().append("svg")
					      .attr("class", "team")
					      .attr("width", width)
					      .attr("height", height)
					    .append("g")


		  		svg.append("path")
				    .attr("d", triangle)
					.style("fill",function(d) {return teamInfo[d.shortname].PrimaryColor;})
				    .style("stroke",function(d) {return teamInfo[d.shortname].SecondaryColor;})
				    .style("stroke-width",function(d) {return 1;})
				    .attr("fill-opactiy", function(d){return 0.5;})
				    .style("opactiy", function(d){return 0.5;})
				    .append("title")
				    .text(function(d) {return d.Tm;});
			    
		    		
			    //Team Labels
			    svg.append("text")
			    		.text(function(d) {return d.shortname + ' ('+ d.W +'-'+d.L+')';})
			    		.style("text-anchor", "middle")
			    		.attr('class','team--label')
			    		.attr('y', 20)
			    		.attr('x', 38);




    			/********************
				*Parallel Coordinates Chart Starts Here
    			*********************/
    			//Move into seperate function.


			}


			d3.csv('data/NFL-PTSDiff-10yrs.csv', plotRegression);


		</script>
	</body>
</html>
